<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lazarus Exchange</title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="icon" href="/favicon.ico" sizes="any" />
</head>

<body>
  <main id="terminal" class="shell">
    <div class="window-bar">
      <div class="window-controls" aria-hidden="true">
        <span class="dot dot-red"></span>
        <span class="dot dot-amber"></span>
        <span class="dot dot-green"></span>
      </div>
      <span class="window-title">root@lazarus: ./exchange --secure --live</span>
    </div>

    <header class="mast">
      <button class="btn btn-reset btn-reset-top" onclick="resetSession()">‚ôªÔ∏è RESET</button>
      <h1 class="title">Lazarus Exchange</h1>
      <p class="tagline">Upload both files, review a blurred preview, then both validate to unlock download.</p>
      <div class="meta-compact">
        <div class="meta-item">
          <span class="meta-label">üîê SESSION</span>
          <span id="sessionIdDisplay" class="meta-value"></span>
        </div>
        <div class="meta-item">
          <span class="meta-label">üßë YOU</span>
          <span id="youDisplay" class="meta-value"></span>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="panel panel-control">
        <div class="panel-title">
          <h2>Channel</h2>
          <button class="hint-dot" aria-label="Channel help"
            data-hint="Share the link once, then upload your file and request preview.">?</button>
        </div>
        <div class="control-grid">
          <div class="control-block">
            <label class="field">Share Link</label>
            <div class="input-row">
              <input id="shareLink" readonly />
              <button class="btn btn-primary btn-copy" onclick="copySessionLink()">üìã COPY</button>
            </div>
          </div>

          <div class="control-block">
            <label class="field">Payload</label>
            <input id="fileInput" type="file"
              accept=".jpg,.jpeg,.png,.webp,.pdf,.txt,image/jpeg,image/png,image/webp,application/pdf,text/plain" />
            <div class="actions">
              <button class="btn btn-upload" onclick="upload()">üì§ UPLOAD</button>
              <button class="btn btn-preview" onclick="preview()">üëÄ PREVIEW</button>
            </div>
          </div>
        </div>
      </section>

      <section class="panel panel-preview">
        <div class="panel-title">
          <h2>Preview</h2>
          <button class="hint-dot" aria-label="Preview help"
            data-hint="Preview is partial and blurred. Original file remains locked until both users validate.">?</button>
        </div>
        <section class="preview-pane" aria-live="polite">
          <img id="previewImage" alt="Secure blurred preview from peer file" hidden />
          <p id="previewCaption" class="preview-caption">No preview loaded yet.</p>
        </section>
        <div class="unlock-box">
          <div class="panel-title unlock-title">
            <h2>Unlock</h2>
            <button class="hint-dot" aria-label="Unlock help"
              data-hint="Both users must validate before download is allowed.">?</button>
          </div>
          <div class="actions unlock-actions">
            <button class="btn btn-validate" onclick="validate()">‚úÖ VALIDATE</button>
            <button class="btn btn-download" onclick="download()">‚¨áÔ∏è DOWNLOAD</button>
          </div>
        </div>
      </section>

      <section class="panel panel-status">
        <div class="panel-title panel-title-status">
          <h2>Console</h2>
          <div class="title-tools">
            <span class="live">LIVE</span>
            <button class="hint-dot" aria-label="Console help"
              data-hint="Live status of your step and peer step.">?</button>
          </div>
        </div>
        <pre id="statusBox">Connecting<span class="cursor">‚ñà</span></pre>
      </section>
    </div>

    <footer class="footer">
      <span>Ephemeral session ‚Ä¢ signed preview URLs ‚Ä¢ private storage</span>
      <span class="pulse">READY</span>
    </footer>

    <output id="toast" class="toast" role="status" aria-live="polite"></output>
  </main>

  <script type="module" src="/script.js"></script>
</body>

</html>
